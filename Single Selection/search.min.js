$.fn.search = function (n) { var i, r = this; r.css("width", n.width).addClass("search-input"); var t, l = $('<div name="result-area" style="width:' + this.outerWidth() + 'px;"></div>'), o = $('<img src="loading.png"/>'), a = $('<input type="text" name="search-field" autocomplete="off" placeholder="' + n.placeholder + '"/>'); r.append(a), r.append(o.hide()); var e = $("#" + r.attr("id") + " [name=search-field]"); function p() { if (e.val().length <= 1) return l.empty(), void o.hide(); var t = '{"' + n.arg + '" : "' + e.val() + '"}'; !function (t) { $.ajax({ type: "POST", url: t.url, data: t.param, contentType: "application/json;", dataType: "json", success: t.func, error: function () { console.log("error") } }) }({ url: n.url, param: t, func: function (t) { var e = JSON.parse(t.d); if (!e.length) return; var a = []; r.append(l), l.append('<input name="filter-items" placeholder="فیلتر ..."/>'), $.each(e, function (t, e) { a.push("<li " + n.id + '="' + e[n.id] + '">' + e[n.text] + "</li>") }), l.append("<ul>" + a.join("") + "</ul>"), i = $("#" + r.attr("id") + " ul li").clone(), o.hide() } }) } e.on("keyup", function () { o.show(), l.empty(), clearTimeout(t), t = setTimeout(p, 1e3) }), e.on("keydown", function () { clearTimeout(t) }), $("#" + r.attr("id")).on("click", "li", function (t) { r.attr("value", $(this).attr(n.id)), function (t, e) { r.append('<span id="' + t + '">' + e + "</span>"), a.val(""), a.removeAttr("placeholder"), n.func(t, e) }($(this).attr(n.id), $(this).text()), l.empty() }), $("#" + r.attr("id")).on("click", "span", function (t) { $(this).remove(), r.removeAttr("value"), a.attr("placeholder", n.placeholder) }), $("#" + r.attr("id")).on("keyup", "input[name=filter-items]", function () { var a = $(this).val(); $("#" + r.attr("id") + " ul").empty(), i.filter(function (t, e) { return "" === a || 0 <= $(e).text().indexOf(a) }).appendTo("#" + r.attr("id") + " ul") }) };